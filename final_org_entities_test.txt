
================================================================================
AUTHENTICATING...
================================================================================
✅ Authenticated as: Llewellyn Nel (llewellyn@bluedawncapital.co.za)
   Role: developer
   Organization ID: 315fa36c-4555-4b2b-8ba3-fdbde31cb940

================================================================================
TEST SUITE 1: ORGANIZATIONAL ENTITIES CRUD (10 tests)
================================================================================

--- Test 1.1: GET All Entities ---

Test 1.1: GET All Entities - ✅ PASSED
  Details: Retrieved 12 entities

--- Test 1.2: GET Entities by Type (company) ---

Test 1.2: GET Entities by Type - ✅ PASSED
  Details: Retrieved 12 companies, all filtered correctly: True

--- Test 1.3: GET Unlinked Entities (level 3, unlinked) ---

Test 1.3: GET Unlinked Entities - ✅ PASSED
  Details: Retrieved 12 unlinked level 3 entities, all without parent_id: True

--- Test 1.4: CREATE New Company Entity (Full Details) ---

Test 1.4: CREATE New Company Entity - ✅ PASSED
  Details: Created entity with ID: f2c1a7eb-0d47-4714-849a-0a77504a1e0f

--- Test 1.5: GET Single Entity ---

Test 1.5: GET Single Entity - ✅ PASSED
  Details: Entity retrieved with all fields populated: True

--- Test 1.6: UPDATE Entity ---

Test 1.6: UPDATE Entity - ✅ PASSED
  Details: Entity updated successfully

--- Test 1.7: Verify Update in Database ---

Test 1.7: Verify Update in Database - ✅ PASSED
  Details: Fields updated correctly: True

--- Test 1.8: DELETE Entity with parent_id (Should Fail) ---
⚠️  SKIPPED: Entities and organizational units are separate systems.
   The link-child endpoint expects organization_units, not organizational_entities.

Test 1.8: DELETE Entity with parent_id (Should Fail) - ❌ FAILED
  Details: SKIPPED - Entities cannot be linked to org units hierarchy

--- Test 1.9: Unlink Entity, Then DELETE ---
⚠️  SKIPPED: Depends on Test 1.8

Test 1.9: Unlink Entity, Then DELETE - ❌ FAILED
  Details: SKIPPED - Depends on hierarchy linking

--- Test 1.10: Verify Soft Delete ---

Test 1.10: Verify Soft Delete - ✅ PASSED
  Details: Deleted entity not in active list: True

================================================================================
TEST SUITE 2: ENTITY LOGO UPLOAD (3 tests)
================================================================================

--- Test 2.1: Create Entity for Logo Testing ---

Test 2.1: Create Entity for Logo Testing - ✅ PASSED
  Details: Created entity ID: 6670f6ab-41a3-4164-9110-4861ea367648

--- Test 2.2: Upload Logo ---

Test 2.2: Upload Logo - ✅ PASSED
  Details: Logo uploaded, URL: /api/entities/6670f6ab-41a3-4164-9110-4861ea367648/logo/691458a7cb8a04c4eda07bb7

--- Test 2.3: Retrieve Logo ---

Test 2.3: Retrieve Logo - ✅ PASSED
  Details: Logo retrieved, Content-Type: image/png

================================================================================
TEST SUITE 3: CUSTOM FIELDS (5 tests)
================================================================================

--- Test 3.1: GET Custom Fields (Initially) ---

Test 3.1: GET Custom Fields (Initially) - ✅ PASSED
  Details: Retrieved 1 custom fields

--- Test 3.2: CREATE Custom Field ---

Test 3.2: CREATE Custom Field - ✅ PASSED
  Details: Created custom field ID: c781013a-604f-44fa-ad31-3deda0aeb261

--- Test 3.3: GET Custom Fields (Has Data) ---

Test 3.3: GET Custom Fields (Has Data) - ✅ PASSED
  Details: Retrieved 2 fields, contains created field: True

--- Test 3.4: CREATE Duplicate Field (Should Fail) ---

Test 3.4: CREATE Duplicate Field (Should Fail) - ✅ PASSED
  Details: Correctly rejected with 400: Field 'iso_certification_1762941096' already exists for company

--- Test 3.5: DELETE Custom Field ---

Test 3.5: DELETE Custom Field - ✅ PASSED
  Details: Custom field deleted successfully

================================================================================
TEST SUITE 4: INTEGRATION WITH HIERARCHY (6 tests)
================================================================================
⚠️  NOTE: Organizational entities and organizational units are separate systems.
   Entities cannot be linked to the org units hierarchy in current implementation.
   Tests 4.3-4.6 will be skipped. Tests 4.1-4.2 verify entity creation.

--- Test 4.1: Create Entity in Settings ---

Test 4.1: Create Entity in Settings - ✅ PASSED
  Details: Created entity ID: e1a5702e-1901-4f13-aa49-57fe8c8198d3, parent_id is None: True

--- Test 4.2: Verify Entity is Unlinked ---

Test 4.2: Verify Entity is Unlinked - ✅ PASSED
  Details: Entity appears in unlinked list: True

--- Test 4.3: Link Entity to Hierarchy ---
⚠️  SKIPPED: Entities and organizational units are separate systems.

Test 4.3: Link Entity to Hierarchy - ❌ FAILED
  Details: SKIPPED - Entities cannot be linked to org units hierarchy

--- Test 4.4: Verify Entity Now Linked ---
⚠️  SKIPPED: Depends on Test 4.3

Test 4.4: Verify Entity Now Linked - ❌ FAILED
  Details: SKIPPED - Depends on hierarchy linking

--- Test 4.5: GET Hierarchy Shows New Entity ---
⚠️  SKIPPED: Depends on Test 4.3

Test 4.5: GET Hierarchy Shows New Entity - ❌ FAILED
  Details: SKIPPED - Depends on hierarchy linking

--- Test 4.6: Unlink Entity ---
⚠️  SKIPPED: Depends on Test 4.3

Test 4.6: Unlink Entity - ❌ FAILED
  Details: SKIPPED - Depends on hierarchy linking

================================================================================
TEST SUITE 5: RBAC VERIFICATION (4 tests)
================================================================================

--- Test 5.1: Master/Developer Can Create Entities ---

Test 5.1: Master/Developer Can Create Entities - ✅ PASSED
  Details: Developer role can create entities

--- Test 5.2: Master/Developer Can Create Custom Fields ---

Test 5.2: Master/Developer Can Create Custom Fields - ✅ PASSED
  Details: Developer role can create custom fields

--- Test 5.3: Verify Audit Logging ---

Test 5.3: Verify Audit Logging - ✅ PASSED
  Details: Found 14 entity-related audit logs

--- Test 5.4: Verify RBAC Enforcement ---

Test 5.4: Verify RBAC Enforcement - ✅ PASSED
  Details: Endpoints properly protected (status: 401)

================================================================================
TEST SUMMARY
================================================================================
Total Tests: 28
Passed: 22 ✅
Failed: 6 ❌
Success Rate: 78.6%

================================================================================
FAILED TESTS DETAILS
================================================================================
❌ Test 1.8: DELETE Entity with parent_id (Should Fail) - SKIPPED - Entities cannot be linked to org units hierarchy
❌ Test 1.9: Unlink Entity, Then DELETE - SKIPPED - Depends on hierarchy linking
❌ Test 4.3: Link Entity to Hierarchy - SKIPPED - Entities cannot be linked to org units hierarchy
❌ Test 4.4: Verify Entity Now Linked - SKIPPED - Depends on hierarchy linking
❌ Test 4.5: GET Hierarchy Shows New Entity - SKIPPED - Depends on hierarchy linking
❌ Test 4.6: Unlink Entity - SKIPPED - Depends on hierarchy linking

================================================================================
TESTING COMPLETE
================================================================================
